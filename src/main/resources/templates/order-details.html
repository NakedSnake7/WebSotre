<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Detalles de Orden | WeedTlan</title>

<link rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<style>
body {
    background: #0f1115;
    font-family: 'Poppins', sans-serif;
    color: #e2e2e2;
}
h2 {
    text-align: center;
    color: #00ffaa;
    text-shadow: 0 0 12px #00ffaa;
    letter-spacing: 2px;
    margin-bottom: 30px;
}
.card-maya {
    background: rgba(255, 255, 255, 0.03);
    padding: 25px;
    border-radius: 20px;
    border: 1px solid rgba(0, 255, 170, 0.25);
    backdrop-filter: blur(12px);
    box-shadow: 0 0 25px rgba(0, 255, 170, 0.15);
}
.label {
    color: #00ffaa;
    font-weight: bold;
}
.valor {
    color: #e2e2e2;
}
.btn-maya {
    border: 1px solid #00ffaa;
    color: #00ffaa;
    background: transparent;
}
.btn-maya:hover {
    background: #00ffaa;
    color: #000;
}
.alert-maya {
    background: rgba(255, 170, 0, 0.08);
    border: 1px solid rgba(255, 170, 0, 0.5);
    color: #ffcc66;
}
</style>
</head>

<body class="container mt-5">

<h2>üìÑ Detalles de la Orden</h2>

<div class="card-maya">

    <!-- CLIENTE -->
    <h4 class="mb-3">üë§ Informaci√≥n del Cliente</h4>

    <p><span class="label">Nombre:</span>
        <span class="valor"
              th:text="${order.user != null ? order.user.fullName : 'Sin nombre'}"></span>
    </p>

    <p><span class="label">Correo:</span>
        <span class="valor"
              th:text="${order.user != null ? order.user.email : 'Sin correo'}"></span>
    </p>

    <p><span class="label">Tel√©fono:</span>
        <span class="valor"
              th:text="${order.user != null ? order.user.phone : 'Sin tel√©fono'}"></span>
    </p>

    <p><span class="label">Direcci√≥n:</span>
        <span class="valor" th:text="${order.address}"></span>
    </p>

    <hr>

    <!-- ORDEN -->
    <h4 class="mb-3">üßæ Informaci√≥n de la Orden</h4>

    <p><span class="label">ID:</span> <span th:text="${order.id}"></span></p>
    <p><span class="label">Fecha:</span> <span th:text="${order.orderDate}"></span></p>

    <p>
        <span class="label">Estado:</span>
        <span class="badge"
              th:classappend="${order.orderStatusBadge}"
              th:text="${order.orderStatusLabel}">
        </span>
    </p>

    <p><span class="label">M√©todo de pago:</span>
        <span th:text="${order.paymentMethod}"></span>
    </p>

    <p><span class="label">Total:</span> $<span th:text="${order.total}"></span></p>

    <hr>

    <!-- CONFIRMAR PAGO TRANSFERENCIA -->
    <div th:if="${order.paymentMethod == 'TRANSFERENCIA' and !order.paid}"
         class="alert alert-maya text-center">

        <p class="mb-3">
            ‚è≥ <strong>Pago por transferencia pendiente de confirmaci√≥n</strong>
        </p>

        <form th:action="@{/orders/confirm-transfer-payment}" method="post">
            <input type="hidden" name="orderId" th:value="${order.id}">
            <button class="btn btn-maya">
                ‚úÖ Confirmar pago recibido
            </button>
        </form>
    </div>

    <hr>

    <!-- ENV√çO -->
    <h4 class="mb-3">üì¶ Env√≠o</h4>

    <!-- Editable solo si est√° PAGADA y NO entregada -->
    <form th:if="${order.paid and !order.delivered}"
          th:action="@{/orders/update-shipping}"
          method="post">

        <input type="hidden" name="orderId" th:value="${order.id}"/>

        <div class="form-group">
            <label class="label">Paqueter√≠a</label>
            <select class="form-control" name="courier" required>
                <option value="">Selecciona</option>
                <option value="DHL" th:selected="${order.carrier == 'DHL'}">DHL</option>
                <option value="FedEx" th:selected="${order.carrier == 'FedEx'}">FedEx</option>
                <option value="UPS" th:selected="${order.carrier == 'UPS'}">UPS</option>
                <option value="Estafeta" th:selected="${order.carrier == 'Estafeta'}">Estafeta</option>
            </select>
        </div>

        <div class="form-group">
            <label class="label">N√∫mero de gu√≠a</label>
            <input type="text" class="form-control"
                   name="trackingNumber"
                   th:value="${order.trackingNumber}" required>
        </div>

        <button class="btn btn-maya">üíæ Guardar</button>
    </form>

    <!-- SOLO LECTURA -->
    <div th:if="${order.delivered}">
        <p><span class="label">Paqueter√≠a:</span> <span th:text="${order.carrier}"></span></p>
        <p><span class="label">Gu√≠a:</span> <span th:text="${order.trackingNumber}"></span></p>
    </div>

    <hr>

    <!-- PRODUCTOS -->
    <h4 class="mb-3">üõí Productos Comprados</h4>

    <table class="table table-dark table-hover">
        <thead>
        <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio</th>
            <th>Subtotal</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${order.items}">
            <td th:text="${item.producto.productName}"></td>
            <td th:text="${item.quantity}"></td>
            <td>$<span th:text="${item.producto.price}"></span></td>
            <td>$<span th:text="${item.quantity * item.producto.price}"></span></td>
        </tr>
        </tbody>
    </table>

    <div class="text-center mt-4">
        <a href="/orders" class="btn btn-maya">‚¨Ö Volver</a>
    </div>

</div>

</body>
</html>
