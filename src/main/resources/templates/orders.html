<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n de √ìrdenes | WeedTlan</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="/assets/css/custom-styles.css">
</head>

<body class="mt-5 container-fluid">

<h2 class="mb-4">üì¶ Gesti√≥n de √ìrdenes ‚Äì WeedTlan</h2>

<div class="tabla-contenedor">
    <table class="table table-dark table-hover table-lg">
        <thead>
        <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Correo</th>
            <th>Tel√©fono</th>
            <th>Estado</th>
            <th>Total</th>
            <th>Fecha</th>
            <th>Acciones</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="order : ${orders}">

            <!-- ID -->
            <td th:text="${order.id}"></td>

            <!-- Cliente -->
            <td th:text="${order.user?.fullName} ?: 'Sin nombre'"></td>
            <td th:text="${order.user?.email} ?: 'Sin correo'"></td>
            <td th:text="${order.user?.phone} ?: 'Sin tel√©fono'"></td>

            <!-- Estado -->
            <td>
                <!-- Estado de la orden -->
             <span class="badge"
      th:classappend="${order.orderStatusBadge}"
      th:text="${order.orderStatusLabel}">
</span>


                <br>

                <!-- Estado de pago -->
               <span class="badge"
      th:classappend="${order.paymentStatus == T(com.WeedTitlan.server.model.PaymentStatus).PAID ? 'badge-success' : 'badge-warning'}"
      th:text="${order.paymentStatusLabel}">
</span>
            </td>

            <!-- Total -->
            <td>$<span th:text="${order.total}"></span></td>

            <!-- Fecha -->
            <td th:text="${order.orderDate}"></td>

            <!-- Acciones -->
            <td>

                <!-- Ver orden -->
                <a class="btn btn-maya btn-sm mb-1"
                   th:href="@{/orders/{id}(id=${order.id})}">
                    Ver
                </a>

                <!-- Cambiar estado: solo si est√° PAGADA y NO ENTREGADA -->
                <form th:if="${order.paymentStatus == 'PAID' and order.orderStatus != 'DELIVERED'}"
                      th:action="@{/orders/{id}/status(id=${order.id})}"
                      method="post"
                      style="display:inline-block;">

                    <select name="status"
                            class="form-control form-control-sm d-inline-block"
                            style="width: 140px;">
                        <option th:value="PROCESSED"
                                th:selected="${order.orderStatus == 'PROCESSED'}">
                            Procesada
                        </option>
                        <option th:value="SHIPPED"
                                th:selected="${order.orderStatus == 'SHIPPED'}">
                            Env√≠o
                        </option>
                        <option th:value="DELIVERED"
                                th:selected="${order.orderStatus == 'DELIVERED'}">
                            Entregada
                        </option>
                    </select>

                    <button class="btn btn-success btn-sm ml-1">‚úî</button>
                </form>

                <!-- Esperando pago -->
                <span th:if="${order.paymentStatus != 'PAID'}"
                      class="text-warning d-block mt-1">
                    ‚è≥ Esperando pago
                </span>

                <!-- Eliminar: solo si NO est√° pagada -->
                <a class="btn btn-danger btn-sm mt-1"
                   th:if="${order.paymentStatus != 'PAID'}"
                   th:href="@{/orders/{id}/delete(id=${order.id})}"
                   onclick="return confirm('¬øSeguro que deseas eliminar esta orden?');">
                    ‚úñ
                </a>

            </td>

        </tr>
        </tbody>
    </table>
</div>

<!-- Volver -->
<a href="/servicio" class="btn btn-maya btn-fixed">
    ‚¨Ö Volver a Servicios
</a>

</body>
</html>
