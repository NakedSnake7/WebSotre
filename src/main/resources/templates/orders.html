<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Gesti√≥n de √ìrdenes | WeedTlan</title>

<!-- Bootstrap -->
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<!-- GOOGLE FONT & ESTILOS -->
<link rel="stylesheet" href="/assets/css/custom-styles.css">

</head>

<body class="mt-5">

	<h2>üì¶ Gesti√≥n de √ìrdenes ‚Äì WeedTlan</h2>

	<div class="tabla-contenedor">
<table class="table table-dark table-hover table-lg">
			<thead>
				<tr>
					<th>ID</th>
					<th>Cliente</th>
					<th>Correo</th>
					<th>Telefono</th>
					<th>Estado</th>
					<th>Total</th>
					<th>Fecha</th>
					<th>Acciones</th>
				</tr>
			</thead>

			<tbody>
				<tr th:each="order : ${orders}">
					<td th:text="${order.id}"></td>

					<td th:text="${order.user?.fullName} ?: 'Sin nombre'"></td>
					<td th:text="${order.user?.email} ?: 'Sin correo'"></td>
					<td th:text="${order.user?.phone} ?: 'Sin tel√©fono'"></td>


<td>
    <span class="badge badge-info"
          th:text="${order.orderStatus}">
    </span>
    <br>
    <span class="badge"
          th:classappend="${order.paymentStatus == 'PAID'} ? 'badge-success' : 'badge-warning'"
          th:text="${order.paymentStatus}">
    </span>
</td>					<td>$<span th:text="${order.total}"></span></td>
					<td th:text="${order.orderDate}"></td>

					<td><a class="btn btn-maya btn-sm"
						th:href="@{/orders/{id}(id=${order.id})}"> Ver </a>

						<form th:action="@{/orders/{id}/status(id=${order.id})}"
      method="post"
      th:if="${order.paymentStatus == 'PAID'}"
      style="display: inline-block;">
      
      <span class="badge badge-info"
      th:text="${order.orderStatus == 'CREATED' ? 'Creada' :
                order.orderStatus == 'PROCESSED' ? 'Procesada' :
                order.orderStatus == 'SHIPPED' ? 'Enviada' :
                order.orderStatus == 'DELIVERED' ? 'Entregada' :
                order.orderStatus}">
</span>

    <select name="status"
            class="form-control form-control-sm d-inline-block"
            style="width: 140px;">
        <option th:selected="${order.orderStatus == 'PROCESSED'}"
                th:value="PROCESSED">Procesada</option>
        <option th:selected="${order.orderStatus == 'SHIPPED'}"
                th:value="SHIPPED">Env√≠o</option>
        <option th:selected="${order.orderStatus == 'DELIVERED'}"
                th:value="DELIVERED">Entregada</option>
                
    </select>
              th:if="${order.paymentStatus == 'PAID' and order.orderStatus != 'DELIVERED'}"

    <button class="btn btn-success btn-sm">‚úî</button>
</form>
<span th:if="${order.paymentStatus != 'PAID'}"
      class="text-warning">
    ‚è≥ Esperando pago
</span>
			<span class="badge"
      th:classappend="
        ${order.orderStatus == 'DELIVERED'} ? 'badge-success' :
        ${order.orderStatus == 'SHIPPED'} ? 'badge-primary' :
        'badge-info'"
      th:text="${order.orderStatus}">
</span>			
						 <a class="btn btn-danger btn-sm"
   th:if="${order.paymentStatus != 'PAID'}"
   th:href="@{/orders/{id}/delete(id=${order.id})}"
   onclick="return confirm('¬øSeguro que deseas eliminar esta orden?');">
    ‚úñ
</a></td>
				</tr>
			</tbody>



		</table>
	</div>
    <!-- Bot√≥n para regresar a servicio.html -->
    <a href="/servicio" class="btn btn-maya btn-fixed">‚¨Ö Volver a Servicios</a>

</body>
</html>
